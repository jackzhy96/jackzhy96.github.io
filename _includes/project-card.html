{% include base_path %}

{% comment %}
  Project Card Include

  This include creates a card layout with:
  - Image/thumbnail on the left
  - Title, description, authors, and links on the right
  - Optional list of associated publications

  Usage in pages:
    {% assign sorted = site.research | sort: 'order' %}
    {% for post in sorted %}
      {% include project-card.html post=post %}
    {% endfor %}

  Required front matter in project files:
  - title: Project title
  - excerpt: Short description
  - order: Numeric order for sorting (matches filename prefix, e.g., 1, 2, 3...)

  Optional front matter:
  - teaser: Image path (supports png, jpg, jpeg, gif, svg, webp)
  - authors: List of authors (your name will be highlighted if it matches site.author.name)
  - venue: Publication venue or context
  - location: Location (e.g., "Baltimore, MD")
  - year: Project year (displayed on cards, e.g., 2022)
  - year_end: End year for multi-year projects (optional, displays as "2022-2024")
  - video_embed: Featured video on detail page (YouTube URL or local MP4/WebM path)
  - website_url: Project website link (or "coming_soon")
  - arxiv_url: arXiv link (or "coming_soon")
  - paper_url: Paper link (or "coming_soon")
  - video_url: Video link (or "coming_soon")
  - code_url: Code repository link (or "coming_soon")
  - dataset_url: Dataset link (or "coming_soon")
  - award: Award text (e.g., "Best Paper Award")
  - publication_only: Set true to display first publication as the entire card (for single-publication projects)
  - publications: List of associated publications, each with:
      - title: Publication title
      - authors: Author string (Zhou, H. will be highlighted)
      - venue: Conference/journal name
      - year: Publication year
      - teaser: Publication-specific thumbnail (supports png, jpg, jpeg, gif, svg, webp)
      - website_url: Project website (or "coming_soon")
      - arxiv_url: arXiv link (or "coming_soon")
      - paper_url: Paper link (or "coming_soon")
      - code_url: Code link (or "coming_soon")
      - dataset_url: Dataset link (or "coming_soon")
      - video_url: Video link (or "coming_soon")
      - slides_url: Slides link (or "coming_soon")
      - award: Award text
      - under_review: Set true for papers under review
      - submit_year: Submission year (optional, used for "submitted in" when under_review)
{% endcomment %}

{% comment %} Handle publication_only mode - use first publication's data {% endcomment %}
{% if post.publication_only and post.publications.first %}
  {% assign pub = post.publications.first %}
  {% if pub.teaser %}
    {% capture teaser %}{{ pub.teaser }}{% endcapture %}
  {% elsif post.teaser %}
    {% capture teaser %}{{ post.teaser }}{% endcapture %}
  {% else %}
    {% assign teaser = site.teaser %}
  {% endif %}
  {% assign title = pub.title %}
{% else %}
  {% if post.header.teaser %}
    {% capture teaser %}{{ post.header.teaser }}{% endcapture %}
  {% elsif post.teaser %}
    {% capture teaser %}{{ post.teaser }}{% endcapture %}
  {% else %}
    {% assign teaser = site.teaser %}
  {% endif %}
  {% if post.id %}
    {% assign title = post.title | markdownify | remove: "<p>" | remove: "</p>" %}
  {% else %}
    {% assign title = post.title %}
  {% endif %}
{% endif %}

<div class="project-card">
  {% if teaser %}
  <div class="project-image">
    <a href="{{ base_path }}{{ post.url }}">
      <img src=
        {% if teaser contains "://" %}
          "{{ teaser }}"
        {% else %}
          "{{ teaser | prepend: "/images/" | prepend: base_path }}"
        {% endif %}
        alt="{{ title }}">
    </a>
  </div>
  {% endif %}

  <div class="project-content">
    <h3><a href="{{ base_path }}{{ post.url }}">{{ title }}</a></h3>

    {% comment %} Publication-only mode: show publication details directly {% endcomment %}
    {% if post.publication_only and post.publications.first %}
      {% assign pub = post.publications.first %}

      {% if post.excerpt %}
      <p class="project-description">{{ post.excerpt | markdownify | remove: "<p>" | remove: "</p>" }}</p>
      {% endif %}

      {% if pub.authors %}
      <p class="project-authors">
        {{ pub.authors | replace: "Zhou, H.", "<span class='highlight-author'>Zhou, H.</span>" | replace: "Zhou, H.*", "<span class='highlight-author'>Zhou, H.*</span>" }}
      </p>
      {% endif %}

      {% if pub.venue or pub.year %}
      <p class="project-meta">
        {% if pub.venue %}<em>{{ pub.venue }}</em>{% endif %}{% if pub.venue and pub.year %}, {% endif %}{% if pub.year %}{{ pub.year }}{% endif %}
      </p>
      {% endif %}

      <div class="project-links">
        {% if pub.website_url %}
          {% if pub.website_url == "coming_soon" %}
          <span class="project-link coming-soon">[Website Coming Soon]</span>
          {% else %}
          <a href="{{ pub.website_url }}" class="project-link" target="_blank">[Website]</a>
          {% endif %}
        {% endif %}

        {% if pub.arxiv_url %}
          {% if pub.arxiv_url == "coming_soon" %}
          <span class="project-link coming-soon">[arXiv Coming Soon]</span>
          {% else %}
          <a href="{{ pub.arxiv_url }}" class="project-link" target="_blank">[arXiv]</a>
          {% endif %}
        {% endif %}

        {% if pub.paper_url %}
          {% if pub.paper_url == "coming_soon" %}
          <span class="project-link coming-soon">[Paper Coming Soon]</span>
          {% else %}
          <a href="{{ pub.paper_url }}" class="project-link" target="_blank">[Paper]</a>
          {% endif %}
        {% endif %}

        {% if pub.video_url %}
          {% if pub.video_url == "coming_soon" %}
          <span class="project-link coming-soon">[Video Coming Soon]</span>
          {% else %}
          <a href="{{ pub.video_url }}" class="project-link" target="_blank">[Video]</a>
          {% endif %}
        {% endif %}

        {% if pub.code_url %}
          {% if pub.code_url == "coming_soon" %}
          <span class="project-link coming-soon">[Code Coming Soon]</span>
          {% else %}
          <a href="{{ pub.code_url }}" class="project-link" target="_blank">[Code]</a>
          {% endif %}
        {% endif %}

        {% if pub.dataset_url %}
          {% if pub.dataset_url == "coming_soon" %}
          <span class="project-link coming-soon">[Dataset Coming Soon]</span>
          {% else %}
          <a href="{{ pub.dataset_url }}" class="project-link" target="_blank">[Dataset]</a>
          {% endif %}
        {% endif %}

        {% if pub.slides_url %}
          {% if pub.slides_url == "coming_soon" %}
          <span class="project-link coming-soon">[Slides Coming Soon]</span>
          {% else %}
          <a href="{{ pub.slides_url }}" class="project-link" target="_blank">[Slides]</a>
          {% endif %}
        {% endif %}

        {% if pub.award %}
        <span class="project-badge">{{ pub.award }}</span>
        {% endif %}

        {% if pub.under_review %}
        <span class="project-link coming-soon">[Under Review]</span>
        {% endif %}
      </div>

    {% else %}
    {% comment %} Normal mode: show project details {% endcomment %}

    {% if post.excerpt %}
    <p class="project-description">{{ post.excerpt | markdownify | remove: "<p>" | remove: "</p>" }}</p>
    {% endif %}

    {% comment %} Project metadata: venue/university, location, year (always shown if defined) {% endcomment %}
    {% if post.venue or post.location or post.year %}
    <p class="project-meta">
      {% if post.venue %}<span class="project-venue">{{ post.venue }}</span>{% endif %}
      {% if post.location %}<span class="project-location">{% if post.venue %} | {% endif %}{{ post.location }}</span>{% endif %}
      {% if post.year %}<span class="project-year">{% if post.venue or post.location %} | {% endif %}{{ post.year }}{% if post.year_end %}-{{ post.year_end }}{% endif %}</span>{% endif %}
    </p>
    {% endif %}

    {% comment %} Show authors only if no publications list (backward compatibility) {% endcomment %}
    {% unless post.publications %}
      {% if post.authors %}
      <p class="project-authors">
        {% for author in post.authors %}
          {% if author == site.author.name or author contains "Zhou" %}
            <span class="highlight-author">{{ author }}</span>{% unless forloop.last %}, {% endunless %}
          {% else %}
            {{ author }}{% unless forloop.last %}, {% endunless %}
          {% endif %}
        {% endfor %}
      </p>
      {% endif %}
    {% endunless %}

    {% comment %} Project-level links (always shown if defined) {% endcomment %}
    <div class="project-links">
      {% if post.website_url %}
        {% if post.website_url == "coming_soon" %}
        <span class="project-link coming-soon">[Website Coming Soon]</span>
        {% else %}
        <a href="{{ post.website_url }}" class="project-link" target="_blank">[Website]</a>
        {% endif %}
      {% endif %}

      {% if post.arxiv_url %}
        {% if post.arxiv_url == "coming_soon" %}
        <span class="project-link coming-soon">[arXiv Coming Soon]</span>
        {% else %}
        <a href="{{ post.arxiv_url }}" class="project-link" target="_blank">[arXiv]</a>
        {% endif %}
      {% endif %}

      {% if post.paper_url %}
        {% if post.paper_url == "coming_soon" %}
        <span class="project-link coming-soon">[Paper Coming Soon]</span>
        {% else %}
        <a href="{{ post.paper_url }}" class="project-link" target="_blank">[Paper]</a>
        {% endif %}
      {% endif %}

      {% if post.code_url %}
        {% if post.code_url == "coming_soon" %}
        <span class="project-link coming-soon">[Code Coming Soon]</span>
        {% else %}
        <a href="{{ post.code_url }}" class="project-link" target="_blank">[Code]</a>
        {% endif %}
      {% endif %}

      {% if post.dataset_url %}
        {% if post.dataset_url == "coming_soon" %}
        <span class="project-link coming-soon">[Dataset Coming Soon]</span>
        {% else %}
        <a href="{{ post.dataset_url }}" class="project-link" target="_blank">[Dataset]</a>
        {% endif %}
      {% endif %}

      {% if post.video_url %}
        {% if post.video_url == "coming_soon" %}
        <span class="project-link coming-soon">[Video Coming Soon]</span>
        {% else %}
        <a href="{{ post.video_url }}" class="project-link" target="_blank">[Video]</a>
        {% endif %}
      {% endif %}

      {% if post.slides_url %}
        {% if post.slides_url == "coming_soon" %}
        <span class="project-link coming-soon">[Slides Coming Soon]</span>
        {% else %}
        <a href="{{ post.slides_url }}" class="project-link" target="_blank">[Slides]</a>
        {% endif %}
      {% endif %}

      {% if post.award %}
      <span class="project-badge">{{ post.award }}</span>
      {% endif %}
    </div>

    {% comment %} Display publications list if available {% endcomment %}
    {% if post.publications %}
    <div class="project-publications">
      {% for pub in post.publications %}
      <div class="project-pub-item{% if pub.teaser %} has-teaser{% endif %}">
        {% if pub.teaser %}
        <div class="project-pub-teaser">
          <img src=
            {% if pub.teaser contains "://" %}
              "{{ pub.teaser }}"
            {% else %}
              "{{ pub.teaser | prepend: "/images/" | prepend: base_path }}"
            {% endif %}
            alt="{{ pub.title }}">
        </div>
        {% endif %}
        <div class="project-pub-content">
          <div class="project-pub-title">{{ pub.title }}</div>

          {% if pub.authors %}
          <div class="project-pub-authors">
            {{ pub.authors | replace: "Zhou, H.", "<span class='highlight-author'>Zhou, H.</span>" | replace: "Zhou, H.*", "<span class='highlight-author'>Zhou, H.*</span>" }}{% if pub.venue %}. <em>{{ pub.venue }}</em>{% endif %}{% if pub.year %}, {{ pub.year }}{% endif %}.
          </div>
          {% endif %}

        <div class="project-links">
          {% if pub.website_url %}
            {% if pub.website_url == "coming_soon" %}
            <span class="project-link coming-soon">[Website Coming Soon]</span>
            {% else %}
            <a href="{{ pub.website_url }}" class="project-link" target="_blank">[Website]</a>
            {% endif %}
          {% endif %}

          {% if pub.arxiv_url %}
            {% if pub.arxiv_url == "coming_soon" %}
            <span class="project-link coming-soon">[arXiv Coming Soon]</span>
            {% else %}
            <a href="{{ pub.arxiv_url }}" class="project-link" target="_blank">[arXiv]</a>
            {% endif %}
          {% endif %}

          {% if pub.paper_url %}
            {% if pub.paper_url == "coming_soon" %}
            <span class="project-link coming-soon">[Paper Coming Soon]</span>
            {% else %}
            <a href="{{ pub.paper_url }}" class="project-link" target="_blank">[Paper]</a>
            {% endif %}
          {% endif %}

          {% if pub.video_url %}
            {% if pub.video_url == "coming_soon" %}
            <span class="project-link coming-soon">[Video Coming Soon]</span>
            {% else %}
            <a href="{{ pub.video_url }}" class="project-link" target="_blank">[Video]</a>
            {% endif %}
          {% endif %}

          {% if pub.code_url %}
            {% if pub.code_url == "coming_soon" %}
            <span class="project-link coming-soon">[Code Coming Soon]</span>
            {% else %}
            <a href="{{ pub.code_url }}" class="project-link" target="_blank">[Code]</a>
            {% endif %}
          {% endif %}

          {% if pub.dataset_url %}
            {% if pub.dataset_url == "coming_soon" %}
            <span class="project-link coming-soon">[Dataset Coming Soon]</span>
            {% else %}
            <a href="{{ pub.dataset_url }}" class="project-link" target="_blank">[Dataset]</a>
            {% endif %}
          {% endif %}

          {% if pub.slides_url %}
            {% if pub.slides_url == "coming_soon" %}
            <span class="project-link coming-soon">[Slides Coming Soon]</span>
            {% else %}
            <a href="{{ pub.slides_url }}" class="project-link" target="_blank">[Slides]</a>
            {% endif %}
          {% endif %}

          {% if pub.award %}
          <span class="project-badge">{{ pub.award }}</span>
          {% endif %}

          {% comment %} Show "Under Review" if specified {% endcomment %}
          {% if pub.under_review %}
          <span class="project-link coming-soon">[Under Review]</span>
          {% endif %}
        </div>
        </div>
      </div>
      {% endfor %}
    </div>
    {% endif %}

    {% endif %}
    {% comment %} End of publication_only check {% endcomment %}

  </div>
</div>
