{% include base_path %}

{% comment %}
  Publication Item Include

  This include creates a clean publication list item with:
  - Title (clickable if paper URL available)
  - Authors with highlighted author name
  - Venue and year
  - Links for paper, code, dataset, etc.

  Usage in pages:
    {% for post in site.publications reversed %}
      {% include publication-item.html post=post %}
    {% endfor %}

  Required front matter:
  - title: Publication title
  - authors: Author string (Zhou, H. will be highlighted)
  - venue: Publication venue

  Optional front matter:
  - website_url: Link to project website (or "coming_soon")
  - paperurl: Link to paper/PDF (or "coming_soon")
  - arxiv_url: Link to arXiv (or "coming_soon")
  - code_url: Link to code (or "coming_soon")
  - dataset_url: Link to dataset (or "coming_soon")
  - video_url: Link to video (or "coming_soon")
  - citation: Full citation text (optional, for reference)
  - under_review: Set to true for papers under review
  - award: Award text if any
{% endcomment %}

{% if post.id %}
  {% assign title = post.title | markdownify | remove: "<p>" | remove: "</p>" %}
{% else %}
  {% assign title = post.title %}
{% endif %}

<div class="publication-item">
  <div class="pub-title">
    {% if post.paperurl %}
      <a href="{{ post.paperurl }}" target="_blank">{{ title }}</a>
    {% elsif post.arxiv_url %}
      <a href="{{ post.arxiv_url }}" target="_blank">{{ title }}</a>
    {% else %}
      <span>{{ title }}</span>
    {% endif %}
  </div>

  {% if post.authors %}
  <div class="pub-authors">
    {% comment %} Parse authors string to highlight author name {% endcomment %}
    {{ post.authors | replace: "Zhou, H.", "<span class='highlight-author'>Zhou, H.</span>" | replace: "Zhou, H.*", "<span class='highlight-author'>Zhou, H.*</span>" }}
  </div>
  {% endif %}

  <div class="pub-venue">
    {% if post.venue %}{{ post.venue }}{% endif %}{% if post.date %}, {{ post.date | date: "%Y" }}{% endif %}
    {% if post.under_review %}<span class="badge badge-highlight">Under Review</span>{% endif %}
    {% if post.award %}<span class="badge badge-award">{{ post.award }}</span>{% endif %}
  </div>

  <div class="pub-links">
    {% if post.website_url %}
      {% if post.website_url == "coming_soon" %}
        <span class="pub-link under-review">[Website Coming Soon]</span>
      {% else %}
        <a href="{{ post.website_url }}" class="pub-link" target="_blank">[Website]</a>
      {% endif %}
    {% endif %}

    {% if post.paperurl %}
      {% if post.paperurl == "coming_soon" %}
        <span class="pub-link under-review">[Paper Coming Soon]</span>
      {% else %}
        <a href="{{ post.paperurl }}" class="pub-link" target="_blank">[Paper]</a>
      {% endif %}
    {% endif %}

    {% if post.arxiv_url %}
      {% if post.arxiv_url == "coming_soon" %}
        <span class="pub-link under-review">[arXiv Coming Soon]</span>
      {% else %}
        <a href="{{ post.arxiv_url }}" class="pub-link" target="_blank">[arXiv]</a>
      {% endif %}
    {% endif %}

    {% if post.video_url %}
      {% if post.video_url == "coming_soon" %}
        <span class="pub-link under-review">[Video Coming Soon]</span>
      {% else %}
        <a href="{{ post.video_url }}" class="pub-link" target="_blank">[Video]</a>
      {% endif %}
    {% endif %}

    {% if post.code_url %}
      {% if post.code_url == "coming_soon" %}
        <span class="pub-link under-review">[Code Coming Soon]</span>
      {% else %}
        <a href="{{ post.code_url }}" class="pub-link" target="_blank">[Code]</a>
      {% endif %}
    {% endif %}

    {% if post.dataset_url %}
      {% if post.dataset_url == "coming_soon" %}
        <span class="pub-link under-review">[Dataset Coming Soon]</span>
      {% else %}
        <a href="{{ post.dataset_url }}" class="pub-link" target="_blank">[Dataset]</a>
      {% endif %}
    {% endif %}

  </div>
</div>
